<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Tag Manager - AI绘图标签管理器</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <span class="logo-icon">🎨</span>
                <h1>AI Tag Manager</h1>
            </div>
            <p class="subtitle">AI绘图标签管理器</p>
            <div class="header-nav">
                <button class="btn btn-nav btn-settings" onclick="openSettingsModal()" title="设置">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                    </svg>
                </button>
                <a href="/gallery" class="btn btn-nav">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7"></rect>
                        <rect x="14" y="3" width="7" height="7"></rect>
                        <rect x="14" y="14" width="7" height="7"></rect>
                        <rect x="3" y="14" width="7" height="7"></rect>
                    </svg>
                    作品画廊
                </a>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Left Panel - Tag Library -->
            <section class="panel tag-library">
                <div class="panel-header">
                    <h2>标签库 / Tag Library</h2>
                    <div class="panel-header-actions">
                        <button class="btn btn-secondary btn-import" onclick="openImportModal()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="17 8 12 3 7 8"></polyline>
                                <line x1="12" y1="3" x2="12" y2="15"></line>
                            </svg>
                            一键导入
                        </button>
                        <button class="btn btn-primary btn-add-tag" onclick="openAddTagModal()">
                            <span>+</span> 添加标签
                        </button>
                    </div>
                </div>

                <!-- Category Filter -->
                <div class="category-filter">
                    <button class="category-btn active" data-category="all">全部 All</button>
                </div>

                <!-- Tags Grid -->
                <div class="tags-container" id="tagsContainer">
                    <!-- Tags will be loaded here -->
                </div>
            </section>

            <!-- Right Panel - Selected Tags & Prompt -->
            <section class="panel prompt-panel">
                <div class="panel-header">
                    <h2>已选标签 / Selected Tags</h2>
                    <button class="btn btn-secondary" onclick="clearSelected()">清空</button>
                </div>

                <!-- Selected Tags -->
                <div class="selected-tags" id="selectedTags">
                    <p class="empty-hint">点击左侧标签添加到这里<br><small style="color: var(--text-muted);">左键点击设为插入点，右键点击移除</small></p>
                </div>

                <!-- Prompt Output -->
                <div class="prompt-section">
                    <div class="prompt-header">
                        <h3>生成的 Prompt</h3>
                        <div class="prompt-actions">
                            <button class="btn btn-icon btn-magic" id="optimizeBtn" onclick="optimizePromptOrder()" title="AI 优化顺序">
                                <span class="btn-icon-content">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"></path>
                                    </svg>
                                </span>
                                <span class="btn-loading" style="display:none;">⏳</span>
                            </button>
                            <button class="btn btn-icon btn-flux" id="fluxBtn" onclick="convertToFluxPrompt()" title="转换为 Flux 自然语言">
                                <span class="btn-icon-content">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                        <path d="M13 8H7"></path>
                                        <path d="M17 12H7"></path>
                                    </svg>
                                </span>
                                <span class="btn-loading" style="display:none;">⏳</span>
                            </button>
                            <button class="btn btn-icon btn-toggle-format" id="toggleFormatBtn" onclick="togglePromptFormat()" title="切换格式" style="display: none;">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="17 1 21 5 17 9"></polyline>
                                    <path d="M3 11V9a4 4 0 0 1 4-4h14"></path>
                                    <polyline points="7 23 3 19 7 15"></polyline>
                                    <path d="M21 13v2a4 4 0 0 1-4 4H3"></path>
                                </svg>
                            </button>
                            <button class="btn btn-icon" onclick="openPromptEditor()" title="编辑">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                </svg>
                            </button>
                            <button class="btn btn-icon" onclick="copyPrompt()" title="复制">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="prompt-output" id="promptOutput">
                        <span class="placeholder">选择标签后生成 Prompt...</span>
                    </div>
                </div>

                <!-- Weight Syntax Options -->
                <div class="options-section">
                    <h4>权重格式 / Weight Format</h4>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="weightFormat" value="sd" checked>
                            <span>SD格式 (tag:1.2)</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="weightFormat" value="nai">
                            <span>NAI格式 {tag}</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="weightFormat" value="plain">
                            <span>纯文本</span>
                        </label>
                    </div>
                </div>
            </section>
        </main>

        <!-- Category Management -->
        <section class="panel category-panel">
            <div class="panel-header">
                <h2>分类管理 / Category Management</h2>
                <button class="btn btn-primary" onclick="openAddCategoryModal()">
                    <span>+</span> 添加分类
                </button>
            </div>
            <div class="categories-list" id="categoriesList">
                <!-- Categories will be loaded here -->
            </div>
        </section>
    </div>

    <!-- Add Tag Modal -->
    <div class="modal" id="addTagModal">
        <div class="modal-overlay" onclick="closeModal('addTagModal')"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>添加新标签 / Add New Tag</h3>
                <button class="btn-close" onclick="closeModal('addTagModal')">&times;</button>
            </div>
            <form id="addTagForm" onsubmit="submitAddTag(event)">
                <div class="form-group">
                    <label>英文名称 / English Name</label>
                    <input type="text" name="name_en" required placeholder="e.g., masterpiece">
                </div>
                <div class="form-group">
                    <label>中文名称 / Chinese Name</label>
                    <input type="text" name="name_zh" required placeholder="例如：杰作">
                </div>
                <div class="form-group">
                    <label>分类 / Category</label>
                    <div id="categoryDisplay" class="category-display" style="display: none;"></div>
                    <div id="categorySelectGroup">
                        <select name="category_id" id="tagCategorySelect" required>
                            <!-- Options loaded dynamically -->
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>权重 / Weight (0.1 - 2.0)</label>
                    <input type="number" name="weight" value="1.0" min="0.1" max="2.0" step="0.1">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addTagModal')">取消</button>
                    <button type="submit" class="btn btn-primary">添加</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Category Modal -->
    <div class="modal" id="addCategoryModal">
        <div class="modal-overlay" onclick="closeModal('addCategoryModal')"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>添加新分类 / Add New Category</h3>
                <button class="btn-close" onclick="closeModal('addCategoryModal')">&times;</button>
            </div>
            <form id="addCategoryForm" onsubmit="submitAddCategory(event)">
                <div class="form-group">
                    <label>英文名称 / English Name</label>
                    <input type="text" name="name_en" required placeholder="e.g., Quality">
                </div>
                <div class="form-group">
                    <label>中文名称 / Chinese Name</label>
                    <input type="text" name="name_zh" required placeholder="例如：质量">
                </div>
                <div class="form-group">
                    <label>颜色 / Color</label>
                    <input type="color" name="color" value="#6366f1">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addCategoryModal')">取消</button>
                    <button type="submit" class="btn btn-primary">添加</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Category Modal -->
    <div class="modal" id="editCategoryModal">
        <div class="modal-overlay" onclick="closeModal('editCategoryModal')"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>编辑分类 / Edit Category</h3>
                <button class="btn-close" onclick="closeModal('editCategoryModal')">&times;</button>
            </div>
            <form id="editCategoryForm" onsubmit="submitEditCategory(event)">
                <input type="hidden" name="id" id="editCategoryId">
                <div class="form-group">
                    <label>英文名称 / English Name</label>
                    <input type="text" name="name_en" id="editCategoryNameEn" required>
                </div>
                <div class="form-group">
                    <label>中文名称 / Chinese Name</label>
                    <input type="text" name="name_zh" id="editCategoryNameZh" required>
                </div>
                <div class="form-group">
                    <label>颜色 / Color</label>
                    <input type="color" name="color" id="editCategoryColor">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-danger" onclick="deleteCurrentCategory()">删除</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('editCategoryModal')">取消</button>
                    <button type="submit" class="btn btn-primary">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Tag Modal -->
    <div class="modal" id="editTagModal">
        <div class="modal-overlay" onclick="closeModal('editTagModal')"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>编辑标签 / Edit Tag</h3>
                <button class="btn-close" onclick="closeModal('editTagModal')">&times;</button>
            </div>
            <form id="editTagForm" onsubmit="submitEditTag(event)">
                <input type="hidden" name="id" id="editTagId">
                <div class="form-group">
                    <label>英文名称 / English Name</label>
                    <input type="text" name="name_en" id="editNameEn" required>
                </div>
                <div class="form-group">
                    <label>中文名称 / Chinese Name</label>
                    <input type="text" name="name_zh" id="editNameZh" required>
                </div>
                <div class="form-group">
                    <label>分类 / Category</label>
                    <select name="category_id" id="editTagCategorySelect" required>
                    </select>
                </div>
                <div class="form-group">
                    <label>权重 / Weight</label>
                    <input type="number" name="weight" id="editWeight" min="0.1" max="2.0" step="0.1">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-danger" onclick="deleteCurrentTag()">删除</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('editTagModal')">取消</button>
                    <button type="submit" class="btn btn-primary">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Import Tags Modal -->
    <div class="modal" id="importTagsModal">
        <div class="modal-overlay" onclick="closeModal('importTagsModal')"></div>
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>一键导入标签 / Batch Import Tags</h3>
                <button class="btn-close" onclick="closeModal('importTagsModal')">&times;</button>
            </div>
            <div class="import-container">
                <!-- Step 1: Input -->
                <div id="importStep1" class="import-step">
                    <div class="form-group">
                        <label>粘贴标签 / Paste Tags</label>
                        <p class="form-hint">支持逗号、换行分隔，自动解析 SD/NAI 格式的权重语法</p>
                        <textarea id="importInput" rows="6" placeholder="masterpiece, best quality, 1girl, long hair, blue eyes&#10;或者&#10;(masterpiece:1.2), {best quality}, anime style"></textarea>
                    </div>
                    <div class="form-group">
                        <label>默认分类 / Default Category</label>
                        <select id="importDefaultCategory">
                            <!-- Options loaded dynamically -->
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('importTagsModal')">取消</button>
                        <button type="button" class="btn btn-primary" onclick="parseImportTags()" id="parseBtn">
                            <span class="btn-text">解析并翻译</span>
                            <span class="btn-loading" style="display:none;">处理中...</span>
                        </button>
                    </div>
                </div>

                <!-- Step 2: Preview and Edit -->
                <div id="importStep2" class="import-step" style="display:none;">
                    <div class="import-summary">
                        <span id="importSummary">共解析 0 个标签，其中 0 个为新标签</span>
                    </div>
                    <div class="import-preview-container">
                        <div class="import-preview-header">
                            <span class="preview-col">标签 Tag</span>
                            <span class="preview-col">翻译 Translation</span>
                            <span class="preview-col">分类 Category</span>
                            <span class="preview-col">操作</span>
                        </div>
                        <div class="import-preview-list" id="importPreviewList">
                            <!-- Preview items will be rendered here -->
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="backToImportStep1()">返回修改</button>
                        <button type="button" class="btn btn-primary" onclick="confirmImport()" id="importBtn">
                            <span class="btn-text">确认导入</span>
                            <span class="btn-loading" style="display:none;">导入中...</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-overlay" onclick="closeModal('settingsModal')"></div>
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>设置 / Settings</h3>
                <button class="btn-close" onclick="closeModal('settingsModal')">&times;</button>
            </div>
            <form id="settingsForm" onsubmit="submitSettings(event)">
                <div class="form-body">
                    <div class="settings-section">
                        <h4 class="settings-section-title">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                            </svg>
                            大模型服务 / LLM Service
                        </h4>
                        <p class="settings-hint">配置后将优先使用大模型进行翻译和分类匹配，获得更准确的结果</p>

                        <div class="form-group">
                            <label class="toggle-label">
                                <input type="checkbox" id="llmEnabled" name="llm_enabled">
                                <span class="toggle-switch"></span>
                                <span class="toggle-text">启用大模型服务</span>
                            </label>
                        </div>

                        <div id="llmSettings" class="llm-settings">
                            <div class="form-group">
                                <label>服务提供商 / Provider</label>
                                <select id="llmProvider" name="provider" onchange="updateProviderSettings()">
                                    <option value="openai">OpenAI (GPT)</option>
                                    <option value="claude">Anthropic (Claude)</option>
                                    <option value="gemini">Google (Gemini)</option>
                                    <option value="ollama">Ollama (本地)</option>
                                </select>
                                <p class="form-hint" id="providerHint">兼容 OpenAI API 格式的服务</p>
                            </div>

                            <div class="form-group">
                                <label>API 地址 / Base URL</label>
                                <input type="text" id="llmBaseUrl" name="base_url"
                                       placeholder="https://api.openai.com/v1">
                                <p class="form-hint" id="baseUrlHint">API 服务的基础地址</p>
                            </div>

                            <div class="form-group" id="apiKeyGroup">
                                <label>API 密钥 / API Key <span id="apiKeyRequired" style="color: var(--danger);">*</span></label>
                                <div class="input-with-action">
                                    <input type="password" id="llmApiKey" name="api_key"
                                           placeholder="sk-...">
                                    <button type="button" class="btn btn-icon" onclick="toggleApiKeyVisibility()" title="显示/隐藏">
                                        <svg id="apiKeyEyeIcon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                            <circle cx="12" cy="12" r="3"></circle>
                                        </svg>
                                    </button>
                                </div>
                                <p class="form-hint" id="apiKeyStatus"></p>
                            </div>

                            <div class="form-group">
                                <label>模型名称 / Model</label>
                                <input type="text" id="llmModel" name="model"
                                       placeholder="gpt-3.5-turbo">
                                <p class="form-hint" id="modelHint">如 gpt-3.5-turbo, gpt-4, claude-3-haiku 等</p>
                            </div>

                            <div class="form-group">
                                <button type="button" class="btn btn-secondary" onclick="testLLMConnection()" id="testLLMBtn">
                                    <span class="btn-text">测试连接</span>
                                    <span class="btn-loading" style="display:none;">测试中...</span>
                                </button>
                                <span id="testResult" class="test-result"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('settingsModal')">取消</button>
                    <button type="submit" class="btn btn-primary">保存设置</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Prompt Editor Modal -->
    <div class="modal" id="promptEditorModal">
        <div class="modal-overlay" onclick="closeModal('promptEditorModal')"></div>
        <div class="modal-content modal-xlarge">
            <div class="modal-header">
                <h3>Prompt 编辑器</h3>
                <button class="btn-close" onclick="closeModal('promptEditorModal')">&times;</button>
            </div>
            <div class="prompt-editor-container">
                <!-- Input Section -->
                <div class="editor-section">
                    <div class="editor-section-header">
                        <h4>Prompt 输入</h4>
                        <div class="editor-actions">
                            <button class="btn btn-secondary btn-sm" onclick="loadSelectedTagsToEditor()">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="7 10 12 15 17 10"></polyline>
                                    <line x1="12" y1="15" x2="12" y2="3"></line>
                                </svg>
                                从已选标签加载
                            </button>
                        </div>
                    </div>
                    <textarea id="promptEditorInput" rows="4" placeholder="在这里粘贴 Prompt，支持 SD/NAI 格式..."></textarea>
                    <div class="parse-buttons">
                        <button class="btn btn-secondary" onclick="localMatchTags()" id="localMatchBtn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.35-4.35"></path>
                            </svg>
                            <span class="btn-text">本地匹配</span>
                            <span class="btn-loading" style="display:none;">匹配中...</span>
                        </button>
                        <button class="btn btn-primary" onclick="smartParseTags()" id="smartParseBtn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
                            </svg>
                            <span class="btn-text">AI 智能解析</span>
                            <span class="btn-loading" style="display:none;">解析中...</span>
                        </button>
                    </div>
                    <p class="parse-hint">本地匹配：从已有标签库中匹配，速度快 | AI 智能解析：调用大模型翻译和分类，更准确</p>
                </div>

                <!-- Parsed Tags Section -->
                <div class="editor-section" id="editorTagsSection" style="display: none;">
                    <div class="editor-section-header">
                        <h4>已解析标签 <span class="tags-count-badge" id="editorTagsCount">0</span></h4>
                        <div class="editor-tag-actions">
                            <button class="btn btn-secondary btn-sm" onclick="selectAllEditorTags()">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="9 11 12 14 22 4"></polyline>
                                    <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
                                </svg>
                                全选
                            </button>
                            <button class="btn btn-secondary btn-sm" onclick="deselectAllEditorTags()">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                </svg>
                                取消全选
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="removeSelectedEditorTags()">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="3 6 5 6 21 6"></polyline>
                                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                </svg>
                                移除选中
                            </button>
                        </div>
                    </div>
                    <div class="editor-tags-container" id="editorTagsContainer">
                        <!-- Tags will be rendered here -->
                    </div>
                </div>

                <!-- Filter Section -->
                <div class="editor-section" id="filterSection" style="display: none;">
                    <div class="editor-section-header">
                        <h4>标签筛选</h4>
                    </div>
                    <div class="filter-options">
                        <!-- 普通筛选 -->
                        <div class="filter-row">
                            <label>按类别筛选:</label>
                            <select id="normalFilterCategory">
                                <!-- Options loaded dynamically -->
                            </select>
                            <button class="btn btn-secondary" onclick="normalFilterByCategory()" id="normalFilterBtn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                                </svg>
                                <span>普通筛选</span>
                            </button>
                        </div>
                        <p class="filter-hint">根据标签已有的分类信息进行筛选，速度快</p>

                        <div class="filter-divider"></div>

                        <!-- AI 智能筛选 -->
                        <div class="filter-row">
                            <label>AI 智能筛选:</label>
                            <select id="smartSelectCategory">
                                <!-- Options loaded dynamically -->
                            </select>
                            <button class="btn btn-primary" onclick="smartSelectByCategory()" id="smartSelectBtn">
                                <span class="btn-text">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
                                    </svg>
                                    AI 智能筛选
                                </span>
                                <span class="btn-loading" style="display:none;">分析中...</span>
                            </button>
                        </div>
                        <p class="filter-hint">AI 分析每个标签与类别的语义相关性，更准确但需要调用大模型服务</p>
                    </div>
                </div>

                <!-- Actions -->
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('promptEditorModal')">取消</button>
                    <button type="button" class="btn btn-primary" onclick="applyEditorChanges()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                        应用更改
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
